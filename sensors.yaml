  - platform: waze_travel_time
    name: Eirik til Hjem
    origin: device_tracker.life360_eirik_zakariassen
    destination: zone.home
    realtime: true
    region: 'EU'

  - platform: waze_travel_time
    name: Hjemmefra til Jobb
    origin: zone.home
    destination: zone.FBU
    realtime: true
    region: 'EU'

  - platform: tautulli
    api_key: !secret tautulli
    host: !secret tautullihost

  - platform: template
    sensors:
      vacuum_status:
        friendly_name: Status
        entity_id:
          - vacuum.xiaomi_vacuum_cleaner
        value_template: 'Status: {{ states.vacuum.xiaomi_vacuum_cleaner.attributes.status }}'
        icon_template: >
          {% set val =  states.vacuum.xiaomi_vacuum_cleaner.attributes.status  %}
          {% if val == 'Charging' %}
            mdi:battery-charging
          {% elif val == 'Cleaning' %}
            mdi:move-resize
          {% elif val == 'Returning home' %}
            mdi:keyboard-return
          {% elif val == 'Idle' %}
            mdi:dots-horizontal
          {% elif val == 'Paused' %}
            mdi:pause-circle
          {% else %}
            mdi:help-circle
          {% endif %}
      vacuum_fan_speed:
        friendly_name: Viftehastighet
        entity_id:
          - vacuum.xiaomi_vacuum_cleaner
        value_template: 'Mode: {{ states.vacuum.xiaomi_vacuum_cleaner.attributes.fan_speed }}'
        icon_template: 'mdi:speedometer'
      vacuum_battery:
        friendly_name: Batteri
        entity_id:
          - vacuum.xiaomi_vacuum_cleaner
        value_template: 'Battery: {{ states.vacuum.xiaomi_vacuum_cleaner.attributes.battery_level }}'
        unit_of_measurement: '%'
        icon_template: '{{ states.vacuum.xiaomi_vacuum_cleaner.attributes.battery_icon }}'
      vacuum_cleaning_time:
        friendly_name: Forrige tid
        entity_id:
          - vacuum.xiaomi_vacuum_cleaner
        value_template: '{{ states.vacuum.xiaomi_vacuum_cleaner.attributes.cleaning_time }}'
        icon_template: 'mdi:timer'
      vacuum_cleaned_area:
        friendly_name: Forrige område
        unit_of_measurement: 'm ²'
        entity_id:
          - vacuum.xiaomi_vacuum_cleaner
        value_template: '{{ states.vacuum.xiaomi_vacuum_cleaner.attributes.cleaned_area }}'
        icon_template: 'mdi:ruler'
      vacuum_cleanmainbrush:
        friendly_name: Hovedbørste
        unit_of_measurement: 'h'
        entity_id:
          - vacuum.xiaomi_vacuum_cleaner
        value_template: '{{ states.vacuum.xiaomi_vacuum_cleaner.attributes.main_brush_left }}'
        icon_template: 'mdi:screwdriver'
      vacuum_cleansidebrush:
        friendly_name: Sidebørste
        unit_of_measurement: 'h'
        entity_id:
          - vacuum.xiaomi_vacuum_cleaner
        value_template: '{{ states.vacuum.xiaomi_vacuum_cleaner.attributes.side_brush_left }}'
        icon_template: 'mdi:screwdriver'
      vacuum_cleanfilter:
        friendly_name: Filter
        unit_of_measurement: 'h'
        entity_id:
          - vacuum.xiaomi_vacuum_cleaner
        value_template: '{{ states.vacuum.xiaomi_vacuum_cleaner.attributes.filter_left }}'
        icon_template: 'mdi:screwdriver'
      vacuum_sensordirtyleft:
        friendly_name: Sensorer
        unit_of_measurement: 'h'
        entity_id:
          - vacuum.xiaomi_vacuum_cleaner
        value_template: '{{ states.vacuum.xiaomi_vacuum_cleaner.attributes.sensor_dirty_left }}'
        icon_template: 'mdi:screwdriver'
      vacuum_do_not_disturb:
        friendly_name: Ikke forstyrr
        entity_id:
          - vacuum.xiaomi_vacuum_cleaner
        value_template: '{{ states.vacuum.xiaomi_vacuum_cleaner.attributes.do_not_disturb }}'
        icon_template: >
          {% set val =  states.vacuum.xiaomi_vacuum_cleaner.attributes.do_not_disturb  %}
          {% if val == 'on' %}
            mdi:do-not-disturb
          {% else %}
            mdi:do-not-disturb-off
          {% endif %}
      vacuum_operation:
        value_template: 'Operasjon'
      vacuum_accessories:
        value_template: 'Vedlikehold'

  - platform: qbittorrent
    url: !secret qbittorrenthost
    username: !secret qbittorrentuser
    password: !secret qbittorrentpassword

  - platform: seventeentrack
    username: !secret seventeenuser
    password: !secret seventeenpass


  - platform: rest
    name: Mirai
    json_attributes:
      - name
      - status
      - used_pct
      - is_decrypted
    resource: !secret mirai_rest_storage
    value_template: '{{ value_json.status }}'
    username: !secret fn_user
    password: !secret fn_password
    authentication: basic
    headers:
      Content-Type: application/json


  - platform: template    
    sensors:
      fn_storage_pct_used:
        friendly_name: "Prosent Full"
        value_template: '{{ states.sensor.mirai.attributes["used_pct"].title() }}'
        entity_id: sensor.mirai

  - platform: rest
    name: Mirai4tb
    json_attributes:
      - name
      - status
      - used_pct
      - is_decrypted
    resource: !secret mirai_rest_storage4tb
    value_template: '{{ value_json.status }}'
    username: !secret fn_user
    password: !secret fn_password
    authentication: basic
    headers:
      Content-Type: application/json


  - platform: template
    sensors:
      fn_storage4tb_pct_used:
        friendly_name: "Prosent Full"
        value_template: '{{ states.sensor.mirai4tb.attributes["used_pct"].title() }}'
        entity_id: sensor.mirai4tb

  

  - platform: rest
    name: Versjon
    json_attributes:
      - fullversion
      - name
      - version
    resource: !secret mirai_rest_version
    value_template: '{{ value_json.fullversion }}'
    username: !secret fn_user
    password: !secret fn_password
    authentication: basic
    headers:
      Content-Type: application/json

  - platform: rest
    name: FN_alert
    resource: !secret mirai_alerts
    value_template: '{{ value_json.objects[0].level }}'
    username: !secret fn_user
    password: !secret fn_password
    authentication: basic
    headers:
      Content-Type: application/json

  - platform: rest
    name: FN_beskjed
    resource: !secret mirai_beskjed
    value_template: '{{ value_json.objects[0].message }}'
    username: !secret fn_user
    password: !secret fn_password
    authentication: basic
    headers:
      Content-Type: application/json


  - platform: template
    sensors:
      eirik_status:
        value_template: '{{ states.input_select.eirik_status_dropdown.state }}'
        friendly_name: 'Eirik'
      w_status:
        value_template: '{{ states.input_select.w_status_dropdown.state }}'
        friendly_name: 'W'


  - platform: template
    sensors:
      vvb_navarende_forbruk:
        value_template: '{{ states.switch.varmtvannsbereder.attributes.current_power_w | multiply(0.001) | round(2) }} kW'
        friendly_name: 'Nåværende forbruk'

  - platform: template
    sensors:
      vvb_dagens_forbruk:
        value_template: '{{ states.switch.varmtvannsbereder.attributes.today_energy_kwh }} kWh'
        friendly_name: 'Dagens forbruk'


  - platform: template
    sensors:
      net_power:
        friendly_name_template: >-
          {% if states('sensor.torketrommel_daglig')|float < 0 %}
            Power Consumption
          {% else %}
            Power Production
          {% endif %}
        value_template: "{{ states('sensor.torketrommel_daglig') | float / 1000 }}"
        unit_of_measurement: 'kWh'


  - platform: template
    sensors:
      stuetv_source:
        friendly_name: "Stuetv source"
        value_template: "{{ state_attr('media_player.stuetv', 'source') }}"


  - platform: template
    sensors:
      eirik_batteri:
        friendly_name: "Eirik Batteri"
        value_template: "{{ state_attr('device_tracker.life360_eirik_zakariassen', 'battery') }}"

  - platform: template
    sensors:
      eirik_lader:
        friendly_name: "Eirik Lader"
        value_template: "{{ state_attr('device_tracker.life360_eirik_zakariassen', 'battery_charging') }}"

  - platform: template
    sensors:
      eirik_kjorer:
        friendly_name: "Eirik Kjører"
        value_template: "{{ state_attr('device_tracker.life360_eirik_zakariassen', 'driving') }}"

  - platform: template
    sensors:
      eirik_hastighet:
        friendly_name: "Eirik hastighet"
        value_template: "{{ state_attr('device_tracker.life360_eirik_zakariassen', 'speed') }}"

  - platform: plex_recently_added
    token: !secret plextokenrecently
    host: 192.168.1.36
    port: 32400
